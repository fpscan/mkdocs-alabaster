
<!DOCTYPE html>
<html>
<head>
  
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <title>Run Ahead &mdash; Alabaster</title>

    <link rel="shortcut icon" href="../../img/favicon.ico">
    <link rel="stylesheet" href="../../css/alabaster.css" type="text/css">
    <link rel="stylesheet" href="../../css/alabaster-overrides.css" type="text/css">

    

    
      <script src="../../search/main.js"></script>
    

    

    <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

    
  
</head>
<body>

  <div class="document">
    <div class="documentwrapper">
      <div class="bodywrapper">
        <div class="body" role="main">
          
            <h1 id="retroarch-run-ahead">RetroArch Run Ahead<a class="headerlink" href="#retroarch-run-ahead" title="Permanent link">¶</a></h1>
<p>Every game has a certain built-in amount of lag, some react on the next displayed frame, some can take 2, 3 or even more frames before an action on the gamepad finally get rendered on screen.<br />
The Run Ahead feature calculates the frames as fast as possible in the background to "rollback" the action as close as possible to the input command requested.</p>
<p>That feature deals with "internal" game logic lag.<br />
This means you can still take advantage of other RetroArch lag reduction methods that happens later, such as Hard GPU Sync or Frame Delay.</p>
<p>It's located in <strong>Quickmenu &gt; Latency</strong> (also in Settings &gt; Latency).</p>
<h2 id="how-many-frames-to-run-ahead">How many frames to Run Ahead?<a class="headerlink" href="#how-many-frames-to-run-ahead" title="Permanent link">¶</a></h2>
<p>We need to find <strong>the shortest internal input lag</strong> a game can have, it's usually just moving the character:</p>
<ul>
<li>Pause emulation (press "P" hotkey on keyboard).</li>
<li>Press and hold a direction on the controller.</li>
<li>Advance emulation frame by frame (press "K" hotkey on keyboard) until the character moves.</li>
</ul>
<p>At best an action will be visible on the next frame, so the frames of lag are <strong>the amount of time you pushed "K" minus 1</strong>.</p>
<p>If you did select an higher number than needed, you will see a stutter/rollback when pushing buttons and possibly various weirdnesses.<br />
If you selected a lower number, repeating the test above will take more than 1 push on the "K" hotkey to see your character move.</p>
<h2 id="can-i-always-use-run-ahead">Can I always use Run Ahead?<a class="headerlink" href="#can-i-always-use-run-ahead" title="Permanent link">¶</a></h2>
<p><strong>Run Ahead relies on save states</strong> so they need to be clean and fast enough.<br />
If a core doesn't support them, this can not work.<br />
Using <strong>Second Instance</strong> mode works around some save states limitation, use it if possible.</p>
<p>Calculating several frames in advance means that your machine must be fast enough to run the core at that level of speed.<br />
<strong>The higher the number of frames you are going to run ahead of emulation, the higher demands it places on your CPU.</strong></p>
<h2 id="more-detailed-explanation">More detailed explanation<a class="headerlink" href="#more-detailed-explanation" title="Permanent link">¶</a></h2>
<p>Here is a more detailed explanation on runahead by its author Dwedit.</p>
<p>How the Run-Ahead feature currently works:</p>
<p>There are two modes of operation.</p>
<ul>
<li>Single-Instance Mode</li>
<li>Two-Instance Mode</li>
</ul>
<p>In Single-Instance mode, when it wants to run a frame, instead it does this:</p>
<ul>
<li>Disable audio and video, run a frame, Save State</li>
<li>Run additional frames with audio and video disabled if we want to run ahead more than one frame</li>
<li>Enable audio and video and run the frame we want to see</li>
<li>Load State</li>
</ul>
<p>All save states and load states are done to ram and never reach the disk.</p>
<p>In Two-Instance mode, it does this:</p>
<ul>
<li>Primary core does Audio only, then saves state</li>
<li>Secondary core loads state, runs frames ahead discarding audio and video, then runs a frame with video only.</li>
</ul>
<p>For performance reasons, it only resyncs the secondary core when input is dirty, otherwise it keeps running additional frames on the secondary core while the input is clean.</p>
<p>Why bother with Two-Instance mode at all? Many of the cores do not leave audio emulation in a clean state after loading state, so you would get buzzing. Using Two-Instance mode makes the primary core not do any load states and avoids that.</p>
<p>In Single-Instance mode, it is possible to improve performance further by running ahead without loading state while input is clean, but I am not currently doing that.<br />
I'd imagine there'd be issues if calling the "run a frame" function left you in a state further along than a single frame.</p>
<p>I'm also not doing any speculative inputs at all.</p>
            
          
        </div>
      </div>
    </div>
    <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
      <div class="sphinxsidebarwrapper">
        
          
            
  <p class="logo">
    <a href="../..">
      <img class="logo" src="../../logo.png" title="Alabaster">
    </a>
  </p>
  



          
            



<h3>Table Of Contents</h3>

<nav>
  
  
    <ul>
    
      <li><a href="#how-many-frames-to-run-ahead">How many frames to Run Ahead?</a></li>
      <ul>
    
  </ul>
    
      <li><a href="#can-i-always-use-run-ahead">Can I always use Run Ahead?</a></li>
      <ul>
    
  </ul>
    
      <li><a href="#more-detailed-explanation">More detailed explanation</a></li>
      <ul>
    
  </ul>
    
  </ul>
  

  
    <hr>
    <ul>
      
        <li class="toctree-l1"><a href="https://github.com/notpushkin/mkdocs-alabaster">Fork me on GitHub</a></li>
      
    </ul>
  
</nav>
          
            
  <h3>Related Topics</h3>
  <ul>
    
      <li>Previous: <a href="../optimal-vsync/" title="previous chapter">
        Optimal Vsync Performance
      </a></li>
    
    
      <li>Next: <a href="../arcade-getting-started/" title="next chapter">
        Getting Started with Arcade Emulation
      </a></li>
    
  </ul>

          
            <div id="searchbox" style="display: none;" role="search">
  <h3>Quick search</h3>
  <form class="search" action="../../search.html" method="get">
    <input name="q" type="text">
    <input value="Go" type="submit">
  </form>
  <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
  </p>
</div>
<script type="text/javascript">
  document.getElementById("searchbox").style.display = "block";
</script>
          
        
      </div>
    </div>
    <div class="clearer"></div>
  </div>

  
    <div class="footer">
      
        &copy; 2019 Alexander Pushkov
      
      
        |
        Powered by <a href="http://www.mkdocs.org">mkdocs 1.1</a>
        &amp; <a href="https://github.com/iamale/mkdocs-alabaster">mkdocs-alabaster</a>
      
    </div>
  

  <!--
  MkDocs version      : 1.1
  Docs Build Date UTC : 2020-05-14 06:50:09
  -->
</body>
</html>